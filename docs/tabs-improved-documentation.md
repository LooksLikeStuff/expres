# Документация: Улучшенная структура вкладок документов и брифов

## Обзор изменений

Вкладки `tab_documents.blade.php` и `tab_brief.blade.php` были переработаны для обеспечения более удобной и простой структуры, соответствующей стилю проекта.

## Основные улучшения

### 1. Упрощенная HTML структура
- Удален `<fieldset>` и `<legend>` в пользу более простой структуры `div`
- Использованы существующие классы проекта: `faq_item__deal`, `faq_block__deal`, `create__group`
- Улучшена семантика и доступность

### 2. Модуль документов (`tab_documents.blade.php`)

#### Функции:
- ✅ Загрузка файлов с drag & drop
- ✅ Поддержка файлов любого размера через Яндекс.Диск
- ✅ Показ количества выбранных файлов
- ✅ Список загруженных документов с действиями
- ✅ Статусы загрузки и ошибок

#### Структура:
```blade
<div class="module__deal" id="module-documents">
    <!-- Блок загрузки файлов -->
    <div class="faq_item__deal">
        <div class="faq_block__deal">
            <div class="create__group">
                <!-- Заголовок с иконкой -->
            </div>
            <div class="faq_text__deal">
                <!-- Форма загрузки с drag & drop -->
            </div>
        </div>
    </div>
    
    <!-- Блок списка документов -->
    <div class="faq_item__deal">
        <!-- Список файлов или сообщение о пустом списке -->
    </div>
</div>
```

### 3. Модуль брифов (`tab_brief.blade.php`)

#### Функции:
- ✅ Отображение статуса привязки брифа
- ✅ Поиск брифов по телефону клиента
- ✅ Привязка/отвязка брифов
- ✅ Индикаторы загрузки и уведомления

#### Структура:
```blade
<div class="module__deal" id="module-brief">
    <!-- Блок статуса брифа -->
    <div class="faq_item__deal">
        <!-- Информация о текущем состоянии брифа -->
    </div>
    
    <!-- Блок поиска брифа -->
    <div class="faq_item__deal">
        <!-- Форма поиска и результаты -->
    </div>
</div>
```

## Новые файлы

### 1. CSS стили: `resources/css/tabs-improved.css`
- Современные стили для всех компонентов
- Адаптивный дизайн для мобильных устройств
- Анимации и переходы
- Совместимость с существующими CSS переменными

### 2. JavaScript: `public/js/tabs-improved.js`
- Современный ES6+ код с обработкой ошибок
- Drag & drop для загрузки файлов
- AJAX запросы для поиска и привязки брифов
- Уведомления и индикаторы загрузки
- Безопасная работа с DOM

### 3. Подключение: `resources/views/deals/partials/components/tabs-improved-includes.blade.php`
- Централизованное подключение всех ресурсов
- Дополнительные стили для интеграции
- Мобильная адаптация

## Как использовать

### 1. Подключение в Blade шаблонах

Добавьте в нужные шаблоны (например, в модальные окна или страницы сделок):

```blade
@include('deals.partials.components.tabs-improved-includes')
```

### 2. Использование JavaScript API

JavaScript предоставляет глобальные функции:

```javascript
// Удаление документа (вызывается из HTML)
deleteDocument(documentId)

// Безопасная работа с DOM (унаследовано из global-error-handler.js)
safeDOMOperation(selector, operation, fallback)
```

### 3. Кастомизация стилей

CSS переменные проекта автоматически используются:
- `var(--blue)` - основной цвет
- `var(--green)` - цвет успеха
- `var(--red)` - цвет ошибки
- `var(--orange)` - цвет предупреждения
- `var(--radius)` - радиус скругления
- `var(--fff)` - белый цвет

## API Endpoints

Для корректной работы необходимы следующие маршруты:

### 1. Загрузка документов
```php
POST /deals/upload-documents
Content-Type: multipart/form-data
Parameters: documents[], _token
```

### 2. Удаление документа
```php
DELETE /deals/delete-document/{id}
Headers: X-CSRF-TOKEN
```

### 3. Поиск брифов
```php
POST /deals/search-briefs
Content-Type: application/json
Parameters: deal_id, client_phone
```

### 4. Привязка брифа
```php
POST /deals/attach-brief
Content-Type: application/json
Parameters: brief_id, brief_type
```

## Совместимость

### Поддерживаемые браузеры:
- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

### Зависимости:
- jQuery 3.6+ (уже подключен в проекте)
- FontAwesome (для иконок)
- CSS переменные проекта

## Безопасность

### 1. CSRF защита
Все AJAX запросы автоматически включают CSRF токен из meta тега.

### 2. Валидация файлов
- Проверка типов файлов на клиенте и сервере
- Ограничения размера (настраиваются на сервере)
- Безопасная загрузка через Яндекс.Диск API

### 3. XSS защита
- Экранирование всех пользовательских данных
- Использование textContent вместо innerHTML где возможно

## Тестирование

### 1. Функциональные тесты
- Загрузка файлов различных типов и размеров
- Drag & drop функциональность
- Поиск и привязка брифов
- Обработка ошибок сети

### 2. Тесты совместимости
- Работа с существующими стилями проекта
- Мобильная версия
- Различные разрешения экрана

## Миграция

### Из старой версии:
1. Замените содержимое `tab_documents.blade.php` и `tab_brief.blade.php`
2. Добавьте подключение `tabs-improved-includes.blade.php`
3. Убедитесь, что необходимые API endpoints настроены
4. Протестируйте функциональность

### Откат к старой версии:
Файлы можно легко откатить, так как изменения затрагивают только структуру представления, но не логику контроллеров.

## Поддержка

При возникновении проблем проверьте:
1. Консоль браузера на наличие JavaScript ошибок
2. Наличие CSRF токена в meta теге
3. Корректность API endpoints
4. Подключение всех необходимых CSS и JS файлов
